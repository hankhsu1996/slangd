# Toolchain configuration (clang-specific)
# These are overridden for static builds which use musl gcc toolchain
build:clang --action_env=CC=clang
build:clang --action_env=CXX=clang++
build:clang --cxxopt='-std=c++23'
build:clang --cxxopt='-stdlib=libc++'
build:clang --linkopt='-stdlib=libc++'

# Standard configuration uses clang
build --config=clang
build --incompatible_strict_action_env

# Performance and caching
build --disk_cache=~/.cache/bazel-disk
build --local_resources=cpu=HOST_CPUS*0.7

# Error reporting
build --verbose_failures

# Debug build configuration
build:debug --compilation_mode=dbg
build:debug --cxxopt='-O0'
build:debug --cxxopt='-g3'
build:debug --cxxopt='-fno-omit-frame-pointer'
build:debug --cxxopt='-fno-optimize-sibling-calls'
build:debug --cxxopt='-Wall'
build:debug --cxxopt='-Wextra'
build:debug --cxxopt='-Wno-unused-parameter'
build:debug --cxxopt='-Wno-deprecated-declarations'
build:debug --linkopt='-rdynamic'
build:debug --linkopt='-ldl'

# Release build configuration
build:release --compilation_mode=opt
build:release --cxxopt='-O3'
build:release --cxxopt='-DNDEBUG'

# Static release build (for distribution) using musl gcc toolchain
# Don't use --config=clang since musl toolchain is gcc-based
build:static --compilation_mode=opt
build:static --cxxopt='-O3'
build:static --cxxopt='-DNDEBUG'
build:static --cxxopt='-std=c++23'
build:static --features=fully_static_link

# Fastbuild configuration
build:fastbuild --compilation_mode=fastbuild
build:fastbuild --cxxopt='-O1'

# Test configuration
test --test_output=errors
test --test_timeout=5
